<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Travel Trends — Login/Register</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link rel="stylesheet" href="/css/styles.css" />
  </head>
  <body>
    <div class="app">
      <div class="wrap">
        <!-- Left: reduced image width -->
        <div class="left">
          <img
            id="hero"
            src="img1.png"
            alt="Travel Trends — Explore the world"
            crossorigin="anonymous"
          />
        </div>
        <!-- Right: expanded content -->
        <div class="right">
          <div class="container">
            <!-- Title + description OUTSIDE the form -->
            <div class="header">
              <div class="brand">
                <div class="dot"></div>
                <h1>Travel Trends</h1>
              </div>
              <p class="lead">
                A complete tour guide application —
                <strong>discover smarter, plan faster, travel happier.</strong>
              </p>
            </div>
            <!-- Card with tabs/forms -->
            <div class="panel">
              <div class="tabs">
                <button id="tab-login" class="tab-btn active" type="button">
                  Login
                </button>
                <button id="tab-register" class="tab-btn" type="button">
                  Register
                </button>
              </div>

              <div id="forms">
                <!-- Login -->
                <form id="login-form" class="form" autocomplete="on">
                  <div class="flex-column"><label>Email</label></div>
                  <div class="inputForm">
                    <svg
                      height="20"
                      viewBox="0 0 32 32"
                      width="20"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="m30.853 13.87a15 15 0 0 0 -29.729 4.082 15.1 15.1 0 0 0 12.876 12.918 15.6 15.6 0 0 0 2.016.13 14.85 14.85 0 0 0 7.715-2.145 1 1 0 1 0 -1.031-1.711 13.007 13.007 0 1 1 5.458-6.529 2.149 2.149 0 0 1 -4.158-.759v-10.856a1 1 0 0 0 -2 0v1.726a8 8 0 1 0 .2 10.325 4.135 4.135 0 0 0 7.83.274 15.2 15.2 0 0 0 .823-7.455zm-14.853 8.13a6 6 0 1 1 6-6 6.006 6.006 0 0 1 -6 6z"
                      />
                    </svg>
                    <input
                      type="email"
                      class="input"
                      name="email"
                      required
                      placeholder="Enter your Email"
                    />
                  </div>

                  <div class="flex-column"><label>Password</label></div>
                  <div class="inputForm">
                    <svg
                      height="20"
                      viewBox="-64 0 512 512"
                      width="20"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="m336 512h-288c-26.453125 0-48-21.523438-48-48v-224c0-26.476562 21.546875-48 48-48h288c26.453125 0 48 21.523438 48 48v224c0 26.476562-21.546875 48-48 48zm-288-288c-8.8125 0-16 7.167969-16 16v224c0 8.832031 7.1875 16 16 16h288c8.8125 0 16-7.167969 16-16v-224c0-8.832031-7.1875-16-16-16zm0 0"
                      />
                      <path
                        d="m304 224c-8.832031 0-16-7.167969-16-16v-80c0-52.929688-43.070312-96-96-96s-96 43.070312-96 96v80c0 8.832031-7.167969 16-16 16s-16-7.167969-16-16v-80c0-70.59375 57.40625-128 128-128s128 57.40625 128 128v80c0 8.832031-7.167969 16-16 16zm0 0"
                      />
                    </svg>
                    <input
                      type="password"
                      class="input"
                      name="password"
                      required
                      minlength="6"
                      placeholder="Enter your Password"
                    />
                    <svg
                      viewBox="0 0 576 512"
                      height="16"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"
                      />
                    </svg>
                  </div>

                  <div class="flex-row">
                    <div>
                      <input type="checkbox" id="remember" /><label
                        for="remember"
                        >Remember me</label
                      >
                    </div>
                    <span class="span">Forgot password?</span>
                  </div>

                  <button class="button-submit" type="submit">Sign In</button>
                  <p class="p">
                    Don't have an account?
                    <span id="go-register" class="span">Sign Up</span>
                  </p>
                  <p class="p line">Or With</p>

                  <div class="flex-row">
                    <button
                      class="btn google"
                      type="button"
                      id="google-decorative"
                    >
                      <!-- Google icon -->
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 512 512"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          fill="#FBBB00"
                          d="M113.47,309.408L95.648,375.94l-65.139,1.378C11.042,341.211,0,299.9,0,256c0-42.451,10.324-82.483,28.624-117.732h0.014l57.992,10.632l25.404,57.644c-5.317,15.501-8.215,32.141-8.215,49.456C103.821,274.792,107.225,292.797,113.47,309.408z"
                        ></path>
                        <path
                          fill="#518EF8"
                          d="M507.527,208.176C510.467,223.662,512,239.655,512,256c0,18.328-1.927,36.206-5.598,53.451c-12.462,58.683-45.025,109.925-90.134,146.187l-0.014-0.014l-73.044-3.727l-10.338-64.535c29.932-17.554,53.324-45.025,65.646-77.911h-136.89V208.176h138.887L507.527,208.176L507.527,208.176z"
                        ></path>
                        <path
                          fill="#28B446"
                          d="M416.253,455.624l0.014,0.014C372.396,490.901,316.666,512,256,512c-97.491,0-182.252-54.491-225.491-134.681l82.961-67.91c21.619,57.698,77.278,98.771,142.53,98.771c28.047,0,54.323-7.582,76.87-20.818L416.253,455.624z"
                        ></path>
                        <path
                          fill="#F14336"
                          d="M419.404,58.936l-82.933,67.896c-23.335-14.586-50.919-23.012-80.471-23.012c-66.729,0-123.429,42.957-143.965,102.724l-83.397-68.276h-0.014C71.23,56.123,157.06,0,256,0C318.115,0,375.068,22.126,419.404,58.936z"
                        ></path>
                      </svg>
                      Google
                    </button>
                    <button class="btn apple" type="button" id="apple-dummy">
                      <!-- Apple icon -->
                      <svg
                        height="20"
                        width="20"
                        viewBox="0 0 22.773 22.773"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M15.769,0c0.053,0,0.106,0,0.162,0c0.13,1.606-0.483,2.806-1.228,3.675c-0.731,0.863-1.732,1.7-3.351,1.573c-0.108-1.583,0.506-2.694,1.25-3.561C13.292,0.879,14.557,0.16,15.769,0z"
                        ></path>
                        <path
                          d="M20.67,16.716c0,0.016,0,0.03,0,0.045c-0.455,1.378-1.104,2.559-1.896,3.655c-0.723,0.995-1.609,2.334-3.191,2.334c-1.367,0-2.275-0.879-3.676-0.903c-1.482-0.024-2.297,0.735-3.652,0.926c-0.155,0-0.31,0-0.462,0c-0.995-0.144-1.798-0.932-2.383-1.642c-1.725-2.098-3.058-4.808-3.306-8.276c0-0.34,0-0.679,0-1.019c0.105-2.482,1.311-4.5,2.914-5.478c0.846-0.52,2.009-0.963,3.304-0.765c.555.086,1.122.276,1.619.464.471.181,1.06.502,1.618.485.378-.011.754-.208,1.135-.347,1.116-.403,2.21-.865,3.652-.648 1.733.262 2.963 1.032 3.723 2.22-1.466.933-2.625 2.339-2.427 4.74 1.365 1.968 2.633 3.244 4.217 4.392z"
                        ></path>
                      </svg>
                      Apple
                    </button>
                  </div>

                  <div class="error" id="login-error"></div>
                </form>

                <!-- Register -->
                <form
                  id="register-form"
                  class="form"
                  style="display: none"
                  autocomplete="on"
                >
                  <div class="flex-row" style="gap: 10px">
                    <div style="flex: 1">
                      <div class="flex-column"><label>First name</label></div>
                      <div class="inputForm">
                        <input
                          type="text"
                          class="input"
                          name="firstName"
                          required
                          placeholder="First name"
                        />
                      </div>
                    </div>
                    <div style="flex: 1">
                      <div class="flex-column"><label>Last name</label></div>
                      <div class="inputForm">
                        <input
                          type="text"
                          class="input"
                          name="lastName"
                          required
                          placeholder="Last name"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="flex-column"><label>Email</label></div>
                  <div class="inputForm">
                    <input
                      type="email"
                      class="input"
                      name="email"
                      required
                      placeholder="name@example.com"
                    />
                  </div>
                  <div class="flex-column"><label>Password</label></div>
                  <div class="inputForm">
                    <input
                      type="password"
                      class="input"
                      name="password"
                      required
                      minlength="6"
                      placeholder="Create a password"
                    />
                  </div>
                  <button class="button-submit" type="submit">
                    Create Account
                  </button>
                  <p class="p">
                    Already have an account?
                    <span id="go-login" class="span">Sign In</span>
                  </p>
                  <div class="error" id="register-error"></div>
                </form>
              </div>

              <!-- Welcome (kept hidden for now) -->
              <div class="welcome" id="welcome">
                <h2>Welcome</h2>
                <p>Signed in successfully.</p>
              </div>

              <!-- Hidden official GIS button -->
              <div class="g-official" aria-hidden="true">
                <div
                  id="g_id_onload"
                  data-client_id="735210808734-9e1vhvcqi63ksus5qfucuu9hbtdff9sn.apps.googleusercontent.com"
                  data-context="signin"
                  data-ux_mode="popup"
                  data-callback="onGoogleCredential"
                  data-auto_prompt="false"
                ></div>
                <div
                  class="g_id_signin"
                  data-type="standard"
                  data-shape="rectangular"
                  data-theme="filled_blue"
                  data-text="signin_with"
                  data-size="large"
                  data-logo_alignment="left"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Inline JS (no separate app.js needed) -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const tabLogin = document.getElementById("tab-login");
        const tabRegister = document.getElementById("tab-register");
        const loginForm = document.getElementById("login-form");
        const registerForm = document.getElementById("register-form");
        const goRegister = document.getElementById("go-register");
        const goLogin = document.getElementById("go-login");

        function showLogin() {
          tabLogin.classList.add("active");
          tabRegister.classList.remove("active");
          if (loginForm) loginForm.style.display = "";
          if (registerForm) registerForm.style.display = "none";
        }

        function showRegister() {
          tabRegister.classList.add("active");
          tabLogin.classList.remove("active");
          if (registerForm) registerForm.style.display = "";
          if (loginForm) loginForm.style.display = "none";
        }

        if (tabLogin) tabLogin.addEventListener("click", showLogin);
        if (tabRegister) tabRegister.addEventListener("click", showRegister);
        if (goRegister) goRegister.addEventListener("click", showRegister);
        if (goLogin) goLogin.addEventListener("click", showLogin);

        // Accent sampling from hero image (optional)
        const img = document.getElementById("hero");
        if (img) {
          img.addEventListener("load", () => {
            try {
              const c = document.createElement("canvas");
              const w = (c.width = Math.min(200, img.naturalWidth));
              const h = (c.height = Math.min(200, img.naturalHeight));
              const ctx = c.getContext("2d");
              ctx.drawImage(img, 0, 0, w, h);
              const data = ctx.getImageData(0, 0, w, h).data;
              let r = 0,
                g = 0,
                b = 0,
                count = 0;
              for (let i = 0; i < data.length; i += 4) {
                r += data[i];
                g += data[i + 1];
                b += data[i + 2];
                count++;
              }
              r = Math.round(r / count);
              g = Math.round(g / count);
              b = Math.round(b / count);
              const accent = `rgb(${r},${g},${b})`;
              document.documentElement.style.setProperty("--accent", accent);
              const lum = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
              document.documentElement.style.setProperty(
                "--accent-contrast",
                lum > 0.55 ? "#0b1320" : "#ffffff"
              );
            } catch {}
          });
        }

        function toast(msg) {
          const el = document.createElement("div");
          el.textContent = msg;
          el.style.cssText =
            "margin:8px 0 0;color:#065f46;background:#ecfdf5;border:1px solid #a7f3d0;padding:8px 10px;border-radius:8px;font-size:14px;";
          const header = document.querySelector(".header");
          if (header && header.parentElement) {
            header.parentElement.insertBefore(el, header.nextSibling);
            setTimeout(() => el.remove(), 3500);
          }
        }

        function setError(id, msg) {
          const el = document.getElementById(id);
          if (el) el.textContent = msg || "";
        }

        // Register (no auto-login; switch back to Login after success)
        if (registerForm) {
          registerForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            setError("register-error", "");
            const body = Object.fromEntries(
              new FormData(registerForm).entries()
            );
            try {
              const res = await fetch("/api/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body),
              });
              const out = await res.json().catch(() => ({}));
              if (!res.ok)
                throw new Error(
                  out.message || `Registration failed (${res.status})`
                );
              showLogin();
              toast("Account created. Please sign in.");
            } catch (err) {
              setError("register-error", err.message);
            }
          });
        }

        // Login (redirect to planner.html)
        if (loginForm) {
          loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            setError("login-error", "");
            const body = Object.fromEntries(new FormData(loginForm).entries());
            try {
              const res = await fetch("/api/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body),
              });
              const out = await res.json().catch(() => ({}));
              if (!res.ok)
                throw new Error(out.message || `Login failed (${res.status})`);
              window.location.assign("/planner.html"); // changed from /welcome.html
            } catch (err) {
              setError("login-error", err.message);
            }
          });
        }

        // Google Sign-In callback (redirect to planner.html)
        window.onGoogleCredential = async (resp) => {
          try {
            const res = await fetch("/api/google", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ credential: resp.credential }),
            });
            const out = await res.json().catch(() => ({}));
            if (!res.ok)
              throw new Error(
                out.message || `Google login failed (${res.status})`
              );
            window.location.assign("/planner.html"); // changed from /welcome.html
          } catch (err) {
            alert(err.message);
          }
        };

        // Bridge decorative Google button -> real GIS button
        let gisReady = false;
        const readyCheck = () => {
          const btn = document.querySelector('.g_id_signin div[role="button"]');
          if (btn) {
            gisReady = true;
            return true;
          }
          return false;
        };
        const observer = new MutationObserver(() => {
          if (readyCheck()) observer.disconnect();
        });
        observer.observe(document.body, { childList: true, subtree: true });

        const googleDecorative = document.getElementById("google-decorative");
        if (googleDecorative) {
          googleDecorative.addEventListener("click", () => {
            const gisBtn = document.querySelector(
              '.g_id_signin div[role="button"]'
            );
            if (gisBtn) gisBtn.click();
            else if (!gisReady)
              alert("Google is still loading. Please try again in a second.");
          });
        }
      });
    </script>
  </body>
</html>
